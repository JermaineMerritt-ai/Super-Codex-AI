# JWT Token Management Utilities

The Super-Codex-AI system includes several JWT token management utilities for authentication and testing:

## üöÄ Recommended: jwt_manager.py (Comprehensive)

The `jwt_manager.py` script is the main utility with both token generation and verification capabilities.

### Usage

```bash
# Issue a new token
python jwt_manager.py issue --user <user_id> --role <role> [options]

# Verify an existing token  
python jwt_manager.py verify <token> [options]
```

### Examples

```bash
# Issue a Council token with immediate verification
python jwt_manager.py issue --user "admin" --role "Council" --exp 30 --verify

# Issue an Heir token using secondary key
python jwt_manager.py issue --user "heir123" --role "Heir" --key "secondary"

# Verify a token
python jwt_manager.py verify eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Debug decode (no verification)
python jwt_manager.py verify --decode-only eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## üìù Individual Scripts

### issue_token.py (Token Generation Only)

Basic token generation utility.

## Usage

```bash
python issue_token.py --user <user_id> --role <role> [--key <key_choice>] [--exp <minutes>]
```

### Arguments

- `--user` (required): User ID (e.g., "heir123", "admin", "testuser")
- `--role` (required): Role claim. Must be one of:
  - `Heir` - Highest authority level
  - `Council` - Council member access
  - `Elder` - Elder privileges  
  - `Custodian` - Standard user access
- `--key` (optional): Which signing key to use. Options:
  - `primary` (default) - Uses SECRET_KEY
  - `secondary` - Uses SECRET_KEY_SECONDARY
- `--exp` (optional): Token expiration in minutes (default: 60)

### Examples

```bash
# Generate a Council token for user "admin" valid for 30 minutes
python issue_token.py --user "admin" --role "Council" --exp 30

# Generate an Heir token using secondary key
python issue_token.py --user "heir123" --role "Heir" --key "secondary"

# Generate a Custodian token with default settings
python issue_token.py --user "user123" --role "Custodian"
```

### Environment Variables

The script requires two environment variables to be set:
- `SECRET_KEY` - Primary JWT signing key
- `SECRET_KEY_SECONDARY` - Secondary JWT signing key for key rotation

These are automatically loaded from the `.env` file if present.

### Token Structure

Generated tokens contain the following claims:
- `sub`: Subject (user ID)
- `role`: User role for authorization
- `iat`: Issued at timestamp
- `exp`: Expiration timestamp

### Integration

Tokens generated by this utility can be used with:
- API authentication endpoints
- Testing and development
- Manual token verification
- Administrative operations

### verify_token.py (Token Verification Only)

Basic token verification utility with dual-key fallback support.

```bash
python verify_token.py <token>
python verify_token.py --decode-only <token>  # Debug mode
```

## üîê Authentication Integration

All utilities are compatible with the dual-key authentication system implemented in `app/security/auth.py`:

- **Primary Key Rotation**: Tokens can be signed with either primary or secondary keys
- **Graceful Fallback**: Verification automatically tries both keys
- **Role-Based Access**: Generated tokens include role claims for authorization
- **Expiration Management**: Configurable token lifetimes with status checking

## üõ†Ô∏è Development & Testing

These utilities are particularly useful for:
- **API Testing**: Generate tokens for endpoint testing
- **Development**: Create tokens without full authentication flow  
- **Debugging**: Decode and analyze token contents
- **Administration**: Manual token management and verification
- **CI/CD**: Automated testing with known tokens

## üìã Token Format

All generated tokens use the standard JWT format with HS256 signing:

```json
{
  "sub": "user_id",       // Subject (user identifier)
  "role": "Heir",         // Role for authorization
  "iat": 1763081437,      // Issued at (Unix timestamp)
  "exp": 1763083237       // Expires at (Unix timestamp)
}
```