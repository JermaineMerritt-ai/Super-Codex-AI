# Alternative Caddyfile Configurations

# 1. DEVELOPMENT - Local testing with custom domain
localhost:8080 {
  encode gzip
  handle_path /api* { reverse_proxy 127.0.0.1:8010 }
  handle_path /ws*  { reverse_proxy 127.0.0.1:8010 }
  handle { reverse_proxy 127.0.0.1:3001 }
}

# 2. STAGING - Subdomain configuration  
staging.your-domain.com {
  encode gzip
  handle_path /api* { reverse_proxy 127.0.0.1:8010 }
  handle_path /ws*  { reverse_proxy 127.0.0.1:8010 }
  handle { reverse_proxy 127.0.0.1:3001 }
}

# 3. PRODUCTION - Enhanced security and headers
your-domain.com {
  encode gzip
  
  # Security headers
  header {
    # HSTS
    Strict-Transport-Security max-age=31536000; includeSubDomains; preload
    # Prevent MIME sniffing
    X-Content-Type-Options nosniff
    # XSS Protection
    X-XSS-Protection "1; mode=block"
    # Clickjacking protection
    X-Frame-Options DENY
    # Referrer Policy
    Referrer-Policy strict-origin-when-cross-origin
    # Content Security Policy (adjust for your needs)
    Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' wss: https:; font-src 'self'; object-src 'none'; media-src 'self'; frame-src 'none';"
  }
  
  # Rate limiting (if Caddy plugin available)
  # rate_limit {
  #   zone dynamic_api {
  #     key {remote_host}
  #     events 100
  #     window 1m
  #   }
  # }
  
  # API routes with CORS headers
  handle_path /api* {
    header Access-Control-Allow-Origin "https://your-domain.com"
    header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    header Access-Control-Allow-Headers "Content-Type, Authorization, X-API-Key"
    header Access-Control-Allow-Credentials true
    reverse_proxy 127.0.0.1:8010
  }
  
  # WebSocket routes
  handle_path /ws* {
    reverse_proxy 127.0.0.1:8010
  }
  
  # Static assets with caching
  handle_path /static* {
    header Cache-Control "public, max-age=31536000"
    reverse_proxy 127.0.0.1:3001
  }
  
  # Frontend SPA
  handle {
    # Try files first, fallback to index.html for SPA routing
    try_files {path} /index.html
    reverse_proxy 127.0.0.1:3001
  }
}

# 4. MULTI-DOMAIN - Different domains for API and frontend
api.your-domain.com {
  encode gzip
  reverse_proxy 127.0.0.1:8010
}

app.your-domain.com {
  encode gzip
  reverse_proxy 127.0.0.1:3001
}

# 5. LOAD BALANCED - Multiple backend instances
your-domain.com {
  encode gzip
  
  # Load balance across multiple API instances
  handle_path /api* {
    reverse_proxy {
      to 127.0.0.1:8010
      to 127.0.0.1:8011  
      to 127.0.0.1:8012
      
      # Health checks
      health_uri /health
      health_interval 10s
      health_timeout 5s
      
      # Load balancing method
      lb_policy round_robin
    }
  }
  
  handle_path /ws* { reverse_proxy 127.0.0.1:8010 }
  handle { reverse_proxy 127.0.0.1:3001 }
}

# 6. DOCKER COMPOSE - Container-based deployment
your-domain.com {
  encode gzip
  handle_path /api* { reverse_proxy backend:8000 }
  handle_path /ws*  { reverse_proxy backend:8000 }
  handle_path /axiom* { reverse_proxy axiom-flame:5000 }
  handle { reverse_proxy frontend:3000 }
}

# 7. PATH-BASED ROUTING - Different apps on same domain
your-domain.com {
  encode gzip
  
  # Main AXIOM app
  handle_path /axiom/* {
    uri strip_prefix /axiom
    reverse_proxy 127.0.0.1:8010
  }
  
  # Dashboard app  
  handle_path /dashboard/* {
    uri strip_prefix /dashboard
    reverse_proxy 127.0.0.1:8020
  }
  
  # API
  handle_path /api* { reverse_proxy 127.0.0.1:8010 }
  handle_path /ws*  { reverse_proxy 127.0.0.1:8010 }
  
  # Main frontend
  handle { reverse_proxy 127.0.0.1:3001 }
}

# 8. HTTPS REDIRECT - Force HTTPS
http://your-domain.com {
  redir https://your-domain.com{uri} permanent
}

your-domain.com {
  encode gzip
  handle_path /api* { reverse_proxy 127.0.0.1:8010 }
  handle_path /ws*  { reverse_proxy 127.0.0.1:8010 }
  handle { reverse_proxy 127.0.0.1:3001 }
}

# 9. MAINTENANCE MODE - Serve maintenance page
# your-domain.com {
#   respond "Service temporarily unavailable. Please try again later." 503 {
#     close
#   }
# }

# 10. LOGGING - Enhanced logging configuration
your-domain.com {
  encode gzip
  
  # Access logging
  log {
    output file /var/log/caddy/access.log {
      roll_size 100MiB
      roll_keep 10
      roll_keep_for 720h
    }
    format json
  }
  
  handle_path /api* { reverse_proxy 127.0.0.1:8010 }
  handle_path /ws*  { reverse_proxy 127.0.0.1:8010 }
  handle { reverse_proxy 127.0.0.1:3001 }
}